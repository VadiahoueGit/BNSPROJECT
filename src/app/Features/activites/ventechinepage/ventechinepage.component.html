<div class="card">
  <div class="d-flex justify-content-end py-3">
    <button type="button" class="btn btn-secondary px-4" (click)="OnCreate()">
      Planifier vente
    </button>
  </div>
  <p-table
    [styleClass]="'p-datatable-sm'"
    #dt2
    [value]="dataList"
    dataKey="id"
    [rows]="8"
    [rowsPerPageOptions]="[10, 25, 50]"
    [paginator]="true"
    [totalRecords]="totalPages" [lazy]="true"
    (onPage)="onPage($event)"
  >
    <ng-template pTemplate="header">
      <tr>
        <th style="color: var(--secondary-color)">Numero de vente</th>
        <th style="color: var(--secondary-color)">Commercial</th>
        <th style="color: var(--secondary-color)">Localité</th>
        <th style="color: var(--secondary-color)">Date prévue</th>
        <th style="color: var(--secondary-color)">Statut</th>
        <th class="d-flex justify-content-center" style="color: var(--secondary-color)">Action</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-dataList>
      <tr>
        <td>
          <span class="">
            {{ dataList?.numVenteChine }}
          </span>
        </td>
        <td>
          <span class="">
            {{ dataList?.commercial.nom }} {{ dataList?.commercial.prenoms }}
          </span>
        </td>
        <td>
          {{ dataList?.localite.nomLocalite }}
        </td>
        <td>
          {{ dataList?.dateVente |date }}
        </td>
        <td>
          {{ dataList?.statut }}
        </td>
        <td>
      <tr class="d-flex justify-content-center gap-3">
        <td>
          <i
            (click)="OnEdit(dataList)"
            style="cursor: pointer"
            class="fas fa-eye text-secondary"
          ></i>
        </td>

      </tr>
      </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">Aucune vente trouvée.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Modal creation -->
<!-- Modal -->
<div *ngIf="isModalOpen" class="custom-modal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header d-flex align-items-center">
        <div
          class="d-flex justify-content-center align-items-center"
          style="
            background-color: rgb(219, 255, 232);
            border-radius: 3rem;
            width: 3rem;
            height: 3rem;
          "
        >
          <i class="fas fa-box-check text-primary fs-3"></i>
        </div>
        <h1
          *ngIf="operation == 'create'"
          class="modal-title fs-5 ms-3"
          id="staticBackdropLabel"
        >
          Création vente chine
        </h1>
        <h1
          *ngIf="operation == 'edit'"
          class="modal-title fs-5 ms-3"
          id="staticBackdropLabel"
        >
          Détail vente chine
        </h1>
      </div>
      <nav class="nav nav-pills flex-column flex-sm-row gap-1 border-bottom">
        <a class="flex-sm text-sm-center nav-link" *ngIf="operation == 'edit'"[class.active]="activeTab === 'detail'"
           (click)="activeElement('detail')">Détails</a>
        <a class="flex-sm text-sm-center nav-link" *ngIf="operation == 'edit'" [class.active]="activeTab === 'suivivente'"
           (click)="activeElement('suivivente')">Suivi des ventes</a>
        <a class="flex-sm text-sm-center nav-link" *ngIf="operation == 'edit'" [class.active]="activeTab === 'retour'"
           (click)="activeElement('retour')">Retours d'emballage</a>
      </nav>
      <div class="modal-body" style="max-height: 70vh;overflow-y: auto;">
        <!-- DETAIL VENTE-->
        <div class="row  tab-pane fade show active" *ngIf="activeTab === 'detail'">
          <div class="d-flex justify-content-end" *ngIf="updateData?.statut == StatutCommande.APPROUVEE && operation == 'edit'">
            <button
              type="submit"
              class="btn btn-warning px-2 mx-2"
              (click)="goToVenteManuelle(updateData)"
            >
              <i class="fa-solid fa-person-to-portal"></i>
              <span class="ms-2">Recuperation au depot</span>
            </button>
          </div>
          <div class="d-flex justify-content-end" *ngIf="updateData?.statut == StatutCommande.ATTENTE_VALIDATION">
            <button
              *ngIf="operation == 'edit' && updateData?.statut == StatutCommande.ATTENTE_VALIDATION"
              type="submit"
              class="btn btn-secondary px-2 mx-2"
              (click)="OnAddGoods(operation,updateData,updateData?.articles)"
            >
              <i class="fas fa-plus"></i>
              <span class="ms-2">Ajouter</span>
            </button>
            <button
              *ngIf="operation == 'edit' && updateData?.statut == StatutCommande.ATTENTE_VALIDATION"
              type="submit"
              class="btn btn-secondary px-2"
              (click)="updateGoods(updateData,operation)"
            >
              <i class="fas fa-edit"></i>
              <span class="ms-2">{{ operation === 'edit' ? 'Modifier' : 'Valider les changements' }}</span>
            </button>
          </div>
          <form [formGroup]="VenteForm" *ngIf="operation == 'create'">
            <fieldset class="row border my-2">
              <legend class="fs-6 text-primary">Ressources & chargement</legend>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label"
                  >Commercial <span class="text-danger">*</span></label
                  >
                  <ng-select
                    class="form-control"
                    [items]="dataListCommercial"
                    bindLabel="fullLabel"
                    bindValue="id"
                    formControlName="commercialId"
                    [searchable]="true"
                    (change)="onCommercialChange($event)"
                  >
                  </ng-select>
                </div>
                <div class="mb-3">
                  <label class="form-label"
                  >Localité <span class="text-danger">*</span></label
                  >
                  <ng-select
                    class="form-control"
                    [items]="dataListLocalite"
                    bindLabel="nomLocalite"
                    bindValue="id"
                    formControlName="localiteId"
                    [searchable]="true"
                  >
                  </ng-select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label"
                  >Date <span class="text-danger">*</span></label
                  >
                  <input
                    type="date"
                    [min]="now"
                    class="form-control"
                    formControlName="venteDate"
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label"
                  >Camion <span class="text-danger">*</span></label
                  >
                  <ng-select
                    class="form-control"
                    [items]="dataListCamion"
                    bindLabel="marque"
                    bindValue="id"
                    formControlName="vehiculeId"
                    [searchable]="true"
                  >
                  </ng-select>
                </div>
              </div>

            </fieldset>
          </form>
          <div>
            <fieldset class="row border my-1"  *ngIf="operation == 'edit' || operation == 'update' || operation == 'createNew'">
              <legend style="font-size: 14px" class="text-secondary">
                Information Livraison
              </legend>

              <div class="row">
                <div class="col-md-4">
                  <strong>Numero vente: </strong>
                  <span>{{ updateData?.numVenteChine }}</span>
                </div>
                <div class="col-md-4">
                  <strong>Commercial: </strong>
                  <span>{{ updateData?.commercial.nom }} {{ updateData?.commercial.nom }}</span>
                </div>
                <div class="col-md-4">
                  <strong>Localité: </strong>
                  <span>{{ updateData?.localite.nomLocalite }}</span>
                </div>
                <div class="col-md-4">
                  <strong>Dépot: </strong>
                  <span>{{ updateData?.commercial.depot.nomDepot }}</span>
                </div>
                <div class="col-md-4">
                  <strong>Montant liquide: </strong>
                  <span>{{ totalLiquide | currency:'XOF' }}</span>
                </div>
              </div>
            </fieldset>
            <fieldset class="row border my-2"  *ngIf="operation == 'edit' || operation == 'update' || operation == 'createNew'">
              <legend style="font-size: 14px" class="text-secondary">
                Informations du véhicule
              </legend>
              <div class="row">
                <div class="col-md-4">
                  <strong>Marque: </strong>
                  <span>{{ updateData?.vehicule.marque }}</span>
                </div>
                <div class="col-md-4">
                  <strong>Immatriculation : </strong>
                  <span>{{ updateData?.vehicule.immatriculation }}</span>
                </div>
                <div class="col-md-4">
                  <strong>Energie : </strong>
                  <span>{{ updateData?.vehicule.energie }}</span>
                </div>
                <div class="col-md-4">
                  <strong>Capacité : </strong>
                  <span>{{ updateData?.vehicule.capacite }}</span>
                </div>
              </div>
            </fieldset>
            <fieldset class="row border my-2">
              <div class="row">
                <legend class="fs-6 text-primary">Articles payants</legend>
                <div class="col-md-4">
                  <button
                    type="button"
                    class="btn btn-secondary my-2"
                    (click)="selectArticle()"
                    [disabled]="VenteForm.controls['commercialId'].invalid"
                    *ngIf="operation != 'createNew'"
                  >
                    Ajouter des articles
                  </button>
                  <button
                    type="button"
                    class="btn btn-secondary my-2"
                    (click)="selectArticleNew()"
                    *ngIf="operation == 'createNew'"
                  >
                    Ajouter des articles
                  </button>
                </div>
              </div>
              <table *ngIf="operation == 'create' || operation == 'createNew'" class="table table-bordered">
                <thead class="table-success">
                <!-- Première ligne d'en-tête -->
                <tr>
                  <th scope="col" colspan="5">PRIX UNITAIRE TTC(FCFA)</th>
                  <th scope="col" colspan="4">MONTANT TTC(FCFA)</th>
                </tr>
                <!-- Deuxième ligne d'en-tête -->
                <tr>
                  <th scope="col">Liquide</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                  <th scope="col">Qte</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                  <th scope="col">Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr *ngFor="let item of  operation == 'createNew'? newCommande : selectedArticles">
                  <td>{{ item?.liquide?.libelle }}</td>
                  <td>{{ prixLiquide[item.id] | number}}</td>
                  <td>{{ prixEmballage[item.id] | number}}</td>
                  <td>{{ prixEmballage[item.id] + prixLiquide[item.id]| number }}</td>
                  <td>
                    <input
                      type="number"
                      class="form-control-custom"
                      [(ngModel)]="item.quantite"
                      [min]="0"
                      [max]="stocksDisponibles[item.liquide.id]"
                      [disabled]="stocksDisponibles[item.liquide.id] === 0"
                      [ngClass]="{
                          invalid: item.quantite > stocksDisponibles[item.liquide.id]
                        }"
                      (blur)="validateQuantite(item)"
                    />
                    / {{stocksDisponibles[item.liquide.id]}}
                  </td>
                  <td>{{ prixLiquideTotal[item.id] | number}}</td>
                  <td>{{ prixEmballageTotal[item.id] | number}}</td>
                  <td>{{ montantTotal[item.id] | number}}</td>
                  <td class="d-flex justify-content-center">
                    <button
                      type="button"
                      class="btn btn-danger btn-sm"
                      (click)="removeArticle(item)"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
                <tr class="table-dark">
                  <th scope="col" colspan="4">Total :</th>
                  <td>{{ totalQte | number}}</td>
                  <td>{{ totalLiquide | number}}</td>
                  <td>{{ totalEmballage | number}}</td>
                  <td>{{ totalGlobal| number }}</td>
                  <td></td>
                </tr>
                </tbody>
              </table>
              <table *ngIf="operation == 'update'" class="table table-bordered">
                <thead class="table-success">
                <!-- Première ligne d'en-tête -->
                <tr>
                  <th scope="col" colspan="5">PRIX UNITAIRE TTC(FCFA)</th>
                  <th scope="col" colspan="4">MONTANT TTC(FCFA)</th>
                </tr>
                <!-- Deuxième ligne d'en-tête -->
                <tr>
                  <th scope="col">Liquide</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                  <th scope="col">Qte</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                  <th scope="col">Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr *ngFor="let item of newCommande">
                  <td>{{ item?.liquide?.libelle }}</td>
                  <td>{{ item.prixUnitaireLiquide | number}}</td>
                  <td>{{ item.prixUnitaireEmballage | number}}</td>
                  <td>{{ (item.prixUnitaireLiquide || 0) * 1 + (item.prixUnitaireEmballage || 0) * 1 | number}}</td>
                  <td>
                    <input
                      type="number"
                      class="form-control-custom"
                      [(ngModel)]="item.quantite"
                      [min]="0"
                      (ngModelChange)="getLocalPrice(item)"
                    />
                    / {{stocksDisponibles[item.liquide.id]}}
                  </td>
                  <td>{{ prixLiquideTotal[item.id] | number}}</td>
                  <td>{{ prixEmballageTotal[item.id] | number}}</td>
                  <td>{{ montantTotal[item.id]| number }}</td>
                  <td class="d-flex justify-content-center">
                    <button
                      type="button"
                      class="btn btn-danger btn-sm"
                      (click)="DeleteArticleCommande(item)"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
                <tr class="table-dark">
                  <th scope="col" colspan="4">Total :</th>
                  <td>{{ totalQte| number }}</td>
                  <td>{{ totalLiquide | number}}</td>
                  <td>{{ totalEmballage | number}}</td>
                  <td>{{ totalGlobal | number}}</td>
                  <td></td>
                </tr>
                </tbody>
              </table>
              <table *ngIf="operation == 'edit'" class="table table-bordered">
                <thead class="table-success">
                <!-- Première ligne d'en-tête -->
                <tr>
                  <th scope="col" colspan="5">PRIX UNITAIRE TTC(FCFA)</th>
                  <th scope="col" colspan="3">MONTANT TTC(FCFA)</th>
                </tr>
                <!-- Deuxième ligne d'en-tête -->
                <tr>
                  <th scope="col">Liquide</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                  <th scope="col">Qte vendu</th>
                  <th scope="col">Qte restante</th>
                  <th scope="col">Qte</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                </tr>
                </thead>

                <tbody>
                <tr *ngFor="let item of updateData?.articles">
                  <td>{{ item.liquide.libelle }}1</td>
                  <td>{{ item.prixUnitaireLiquide | number}}</td>
                  <td>{{ item.prixUnitaireEmballage | number}}</td>
                  <td>{{ Number(item.prixUnitaireLiquide ?? 0) + Number(item.prixUnitaireEmballage ?? 0) | number}}</td>
                  <td>{{ item.quantiteVendue }}</td>
                  <td>{{ item.quantite }}</td>
                  <td>{{ item.quantiteAffectee }}</td>
                  <td>{{ item.montantLiquide | number}}</td>
                  <td>{{ item.montantEmballage | number}}</td>
                  <td>{{ Number(item.montantLiquide ?? 0) + Number(item.montantEmballage ?? 0) | number}}</td>

                </tr>
                <tr class="table-dark">
                  <th scope="col" colspan="4">Total :</th>
                  <td>{{totalQteVendue | number}}</td>
                  <td>{{totalQteRestant | number}}</td>
                  <td>{{ totalQte| number }}</td>
                  <td>{{ totalLiquide | number}}</td>
                  <td>{{ totalEmballage | number}}</td>
                  <td>{{ totalGlobal | number}}</td>
                </tr>
                </tbody>
              </table>
            </fieldset>
            <fieldset class="row border my-2">
              <div class="row">
                <legend class="fs-6 text-primary">Articles gratuits</legend>
                <div class="col-md-4">
                  <button
                    type="button"
                    class="btn btn-secondary my-2"
                    (click)="selectArticleGratuit()"
                    [disabled]="VenteForm.controls['commercialId'].invalid "
                    *ngIf="operation != 'createNew'"
                  >
                    Ajouter des gratuités
                  </button>
                  <button
                    type="button"
                    class="btn btn-secondary my-2"
                    (click)="selectArticleGratuitNew()"
                    *ngIf="operation == 'createNew'"
                  >
                    Ajouter des gratuités
                  </button>
                </div>
              </div>
              <table *ngIf="operation == 'create' || operation == 'createNew'" class="table table-bordered">
                <thead class="table-success">
                <!-- Première ligne d'en-tête -->
                <tr>
                  <th scope="col" colspan="5">PRIX UNITAIRE TTC(FCFA)</th>
                  <th scope="col" colspan="4">MONTANT TTC(FCFA)</th>
                </tr>
                <!-- Deuxième ligne d'en-tête -->
                <tr>
                  <th scope="col">Liquide</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                  <th scope="col">Qte</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                  <th scope="col">Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr *ngFor="let item of  operation == 'createNew'? newCommandeGratuit : selectedArticlesFree">
                  <td>{{ item?.liquide?.libelle }}</td>
                  <td>{{ prixLiquideFree[item.id] | number}}</td>
                  <td>{{ prixEmballageFree[item.id] | number}}</td>
                  <td>{{ prixEmballageFree[item.id] + prixLiquideFree[item.id]| number }}</td>
                  <td>
                    <input
                      type="number"
                      class="form-control-custom"
                      [(ngModel)]="item.quantite"
                      [min]="0"
                      [max]="stocksDisponibles[item.liquide.id]"
                      [disabled]="stocksDisponibles[item.liquide.id] === 0"
                      [ngClass]="{
                          invalid: item.quantite > stocksDisponibles[item.liquide.id]
                        }"
                      (blur)="validateQuantiteFree(item)"
                    />
                    / {{stocksDisponibles[item.liquide.id]}}
                  </td>

                  <td>{{ prixLiquideTotalFree[item.id] | number}}</td>
                  <td>{{ prixEmballageTotalFree[item.id] | number}}</td>
                  <td>{{ montantTotalFree[item.id] | number}}</td>
                  <td class="d-flex justify-content-center">
                    <button
                      type="button"
                      class="btn btn-danger btn-sm"
                      (click)="removeArticleFree(item)"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
                <tr class="table-dark">
                  <th scope="col" colspan="4">Total :</th>
                  <td></td>
                  <td>{{ totalQteFree | number }}</td>
                  <td>{{ totalLiquideFree | number }}</td>
                  <td>{{ totalEmballageFree | number}}</td>
                  <td>{{ totalGlobalFree | number }}</td>
                  <td></td>
                </tr>
                </tbody>
              </table>
              <table *ngIf="operation == 'update'" class="table table-bordered">
                <thead class="table-success">
                <!-- Première ligne d'en-tête -->
                <tr>
                  <th scope="col" colspan="5">PRIX UNITAIRE TTC(FCFA)</th>
                  <th scope="col" colspan="4">MONTANT TTC(FCFA)</th>
                </tr>
                <!-- Deuxième ligne d'en-tête -->
                <tr>
                  <th scope="col">Liquide</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                  <th scope="col">Qte</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                  <th scope="col">Actions</th>
                </tr>
                </thead>

                <tbody>
                <tr *ngFor="let item of newCommandeGratuit">
                  <td>{{ item?.liquide?.libelle }}</td>
                  <td>{{ item.prixUnitaireLiquide | number}}</td>
                  <td>{{ item.prixUnitaireEmballage | number}}</td>
                  <td>{{ (item.prixUnitaireLiquide || 0) * 1 + (item.prixUnitaireEmballage || 0) * 1 | number}}</td>
                  <td>
                    <input
                      type="number"
                      class="form-control-custom"
                      [(ngModel)]="item.quantite"
                      [min]="0"
                      [max]="stocksDisponibles[item.liquide.id]"
                      [disabled]="stocksDisponibles[item.liquide.id] === 0"
                      [ngClass]="{
                        invalid: item.quantite > stocksDisponibles[item.liquide.id]
                      }"
                      (blur)="validateQuantiteFree(item)"
                    />
                    / {{stocksDisponibles[item.liquide.id]}}
                  </td>
                  <td>{{ prixLiquideTotalFree[item.id] | number}}</td>
                  <td>{{ prixEmballageTotalFree[item.id] | number}}</td>
                  <td>{{ montantTotalFree[item.id]| number }}</td>
                  <td class="d-flex justify-content-center">
                    <button
                      type="button"
                      class="btn btn-danger btn-sm"
                      (click)="DeleteArticleCommandeFree(item)"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
                <tr class="table-dark">
                  <th scope="col" colspan="4">Total :</th>
                  <td>{{ totalQteFree | number }}</td>
                  <td>{{ totalLiquideFree | number }}</td>
                  <td>{{ totalEmballageFree | number}}</td>
                  <td>{{ totalGlobalFree | number }}</td>
                  <td></td>
                </tr>
                </tbody>
              </table>
              <table *ngIf="operation == 'edit'" class="table table-bordered">
                <thead class="table-success">
                <!-- Première ligne d'en-tête -->
                <tr>
                  <th scope="col" colspan="5">PRIX UNITAIRE TTC(FCFA)</th>
                  <th scope="col" colspan="3">MONTANT TTC(FCFA)</th>
                </tr>
                <!-- Deuxième ligne d'en-tête -->
                <tr>
                  <th scope="col">Liquide</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                  <th scope="col">Qte vendu</th>
                  <th scope="col">Qte restante</th>
                  <th scope="col">Qte</th>
                  <th scope="col">Liquide (FCFA)</th>
                  <th scope="col">Emballage (FCFA)</th>
                  <th scope="col">Total (FCFA)</th>
                </tr>
                </thead>

                <tbody>
                <tr *ngFor="let item of updateData?.articlesGratuit">
                  <td>{{ item.liquide.libelle }}1</td>
                  <td>{{ item.prixUnitaireLiquide | number}}</td>
                  <td>{{ item.prixUnitaireEmballage | number}}</td>
                  <td>{{ Number(item.prixUnitaireLiquide ?? 0) + Number(item.prixUnitaireEmballage ?? 0) | number}}</td>
                  <td>{{ item.quantiteAffectee - item.quantite }}</td>
                  <td>{{ item.quantite }}</td>
                  <td>{{ item.quantiteAffectee }}</td>
                  <td>{{ item.montantLiquide | number}}</td>
                  <td>{{ item.montantEmballage | number}}</td>
                  <td>{{ Number(item.montantLiquide ?? 0) + Number(item.montantEmballage ?? 0) | number}}</td>

                </tr>
                <tr class="table-dark">
                  <th scope="col" colspan="4">Total :</th>
                  <td></td><td></td>
                  <td>{{ totalQteFree | number }}</td>
                  <td>{{ totalLiquideFree | number }}</td>
                  <td>{{ totalEmballageFree | number}}</td>
                  <td>{{ totalGlobalFree | number }}</td>
                </tr>
                </tbody>
              </table>
            </fieldset>
          </div>

        </div>
        <!--  SUIVI VENTE-->
        <div class="row tab-pane fade show active" *ngIf="activeTab === 'suivivente' && operation == 'edit'">
          <fieldset class="row border my-2" *ngFor="let data of updateData.ventes">
            <div class="row d-flex justify-content-between align-items-center">

              <legend class="text-primary">Client - {{data.pointdevente.nomEtablissement}} au {{data.pointdevente.telephone}} </legend>
              <label class="text-secondary" *ngIf="data.signatureClient" style="cursor:pointer" (click)="OnViewSign(data.signatureClient)">Voir signature</label>
            </div>
            <div class="d-flex flex-row justify-content-between align-items-center flex-wrap my-2" >
              <div><span>Date - {{data.dateVente | date:'dd/MM/yyyy HH:mm:ss'}}</span></div>
             <div><span>Montant à perçevoir : </span><span>{{data.transaction?.montantAPercevoir | currency :'XOF'}}</span></div>
              <div><span>Montant perçu : </span><span>{{data.transaction?.montantPercu | currency :'XOF'}}</span></div>
              <div><span>Montant restant : </span><span>{{data.transaction?.montantRestant | currency :'XOF'}}</span></div>
            </div>
            <div
              class="table-responsive"
              style="max-height: 300px; overflow-y: auto"
            >
              <table class="table">
                <thead>
                <tr style="font-size: small">
                  <th scope="col">Produits</th>
                  <th scope="col">Qte liquide vendu</th>
                  <th scope="col">Prix liquide</th>
                  <th scope="col">Prix total</th>
                </tr>
                </thead>
                <tbody>
                <tr
                  style="font-size: small"
                  *ngFor="let item of data.articles; let i = index"
                >
                  <td>
                    {{ item.liquide.libelle }}
                    <span *ngIf="item.isGratuit" class="badge bg-success ml-2">
                      Gratuit
                      </span>
                  </td>
                  <td>{{ item.quantite | number}}</td>
                  <td>{{ item.prixUnitaire | number}}</td>
                  <td>{{ item.montantTotal | number}}</td>

                </tr>

                <!-- Ajoutez d'autres lignes si nécessaire -->
                </tbody>
              </table>
            </div>

<!--            <div-->
<!--              class="table-responsive"-->
<!--              style="max-height: 300px; overflow-y: auto"-->
<!--            >-->
<!--              <table class="table">-->
<!--                <thead>-->
<!--                <tr style="font-size: small">-->
<!--                  <th scope="col">Produits</th>-->
<!--                  <th scope="col" class="text-center">Qte Emballage retourné</th>-->
<!--                </tr>-->
<!--                </thead>-->
<!--                <tbody>-->
<!--                <tr-->
<!--                  style="font-size: small"-->
<!--                  *ngFor="let item of data.articles; let i = index"-->
<!--                >-->
<!--                  <td>{{ item.emballage.libelle }}</td>-->
<!--                  <td class="text-center">{{ item.quantite }}</td>-->

<!--                </tr>-->

<!--                &lt;!&ndash; Ajoutez d'autres lignes si nécessaire &ndash;&gt;-->
<!--                </tbody>-->
<!--              </table>-->
<!--            </div>-->
          </fieldset>
          <label *ngIf="updateData.ventes.length == 0" class="text-gray text-center my-4">Aucune vente effectuée</label>
        </div>
        <!--  RETOUR EMBALLAGE-->
        <div class="row tab-pane fade show active" *ngIf="activeTab === 'retour'  && operation == 'edit'">
          <fieldset class="row border my-2" *ngFor="let data of updateData.retours">
            <legend class="text-primary">Client - {{data.client?.nomEtablissement}} au {{data.client?.telephone}} </legend>
            <div class="d-flex flex-row justify-content-between align-items-center flex-wrap my-2" >
              <div><span>Date de retour- {{data.createdAt | date:'dd/MM/yyyy HH:mm:ss'}}</span></div>
              <div><span>Type de retour- {{data.returnType}}</span></div>
              <div><span>Statut : {{data.status}}</span></div>
            </div>
            <div
              class="table-responsive"
              style="max-height: 300px; overflow-y: auto"
            >
              <table class="table">
                <thead>
                <tr style="font-size: small">
                  <th scope="col">Types</th>
                  <th scope="col">Codes</th>
                  <th scope="col">Produits</th>
                  <th scope="col">Quantite</th>
                  <th scope="col">Prix unitaire</th>
                </tr>
                </thead>
                <tbody>
                <tr
                  style="font-size: small"
                  *ngFor="let item of getFilteredArticles(data); let i = index"
                >
                  <td>{{ item.typeArticle }}</td>
                  <td>{{ item.productCode }}</td>
                  <td>{{ item.libelle }}</td>
                  <td>{{ item.quantity }}</td>
                  <td>{{ item.prixUnitaire| number }}</td>

                </tr>

                <!-- Ajoutez d'autres lignes si nécessaire -->
                </tbody>
              </table>
            </div>

          </fieldset>
          <label *ngIf="updateData.retours.length == 0" class="text-gray text-center my-4">Aucune recupération effectuée</label>
        </div>
        <div class="modal-footer gap-3 px-4y">
          <button
            *ngIf="operation == 'createNew' || operation == 'update' "
            (click)="saveGoods(operation)"
            type="button"
            class="btn btn-primary"
          >
            Enregistrer
          </button>
          <button
            (click)="OnCloseModal()"
            type="button"
            class="btn btn-secondary px-2"
          >
            Annuler
          </button>
          <button
            type="submit"
            *ngIf="operation == 'create'"
            [disabled]="totalQte === 0 && totalQteFree === 0"
            (click)="onSubmit()"
            class="btn btn-primary px-2"
          >
            Valider
          </button>
        </div>
      </div>


    </div>
  </div>
</div>
  <!--CHOIX ARTICLE-->
  <div *ngIf="isChoiceModalOpen" class="custom-modal">
    <div class="modal-dialog2 modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header d-flex align-items-center">
          <div
            class="d-flex justify-content-center align-items-center"
            style="
            background-color: rgb(219, 255, 232);
            border-radius: 3rem;
            width: 3rem;
            height: 3rem;
          "
          >
            <i class="fas fa-box-check text-primary fs-3"></i>
          </div>
          <h1 class="modal-title fs-5 ms-3" id="staticBackdropLabel">
            Selection des articles
          </h1>
        </div>

        <div class="modal-body">
          <form>
            <div class="row">
              <fieldset class="row border my-2">
                <div class="p-3">
                  <!-- Champ de recherche -->
                  <input
                    type="text"
                    name="search"
                    (input)="filterArticles()"
                    [(ngModel)]="searchTerm"
                    placeholder="Rechercher un produit"
                    class="form-control mb-3"
                  />
                </div>
                <div
                  class="table-responsive"
                  style="max-height: 200px; overflow-y: auto"
                >
                  <table class="table">
                    <thead>
                    <tr style="font-size: small">
                      <th scope="col" class="text-secondary">Code</th>
                      <th scope="col" class="text-secondary">Produits</th>
                      <th scope="col" class="text-secondary">Disponibilité</th>
                      <th scope="col" class="text-secondary text-center">
                        Choix
                      </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr
                      *ngFor="let article of filteredArticleList ; let i = index"
                      style="font-size: small"
                    >
                      <th scope="row">{{ article.reference }}</th>
                      <th scope="row">{{ article.libelle }}</th>
                      <th scope="row">{{ stocksDisponibles[article.liquide.id] }}</th>
                      <td class="">
                        <input
                          type="checkbox"
                          class="form-control-custom"
                          [name]="'checkbox_' + i"
                          [(ngModel)]="article.isChecked"
                          (change)="onCheckboxChange(article)"
                          [disabled]="stocksDisponibles[article.liquide.id] <=0"
                        />

                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </fieldset>
            </div>
          </form>
        </div>
        <div class="modal-footer gap-3 px-4y">
          <button
            (click)="OnCloseChoiceModal()"
            type="button"
            class="btn btn-secondary px-2"
          >
            Annuler
          </button>
          <button
            type="submit"
            (click)="onSubmitSelection()"
            class="btn btn-primary px-2"
          >
            Valider
          </button>
        </div>
      </div>
    </div>
  </div>

  <!--CHOIX GRATUITE-->
  <div *ngIf="isChoiceModalFreeOpen" class="custom-modal">
    <div class="modal-dialog2 modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header d-flex align-items-center">
          <div
            class="d-flex justify-content-center align-items-center"
            style="
            background-color: rgb(219, 255, 232);
            border-radius: 3rem;
            width: 3rem;
            height: 3rem;
          "
          >
            <i class="fas fa-box-check text-primary fs-3"></i>
          </div>
          <h1 class="modal-title fs-5 ms-3" id="staticBackdropLabel">
            Selection des articles gratuits
          </h1>
        </div>

        <div class="modal-body">
          <form>
            <div class="row">
              <fieldset class="row border my-2">
                <div class="p-3">
                  <!-- Champ de recherche -->
                  <input
                    type="text"
                    name="search"
                    (input)="filterArticlesFree()"
                    [(ngModel)]="searchTermFree"
                    placeholder="Rechercher un produit"
                    class="form-control mb-3"
                  />
                </div>
                <div
                  class="table-responsive"
                  style="max-height: 200px; overflow-y: auto"
                >
                  <table class="table">
                    <thead>
                    <tr style="font-size: small">
                      <th scope="col" class="text-secondary">Code</th>
                      <th scope="col" class="text-secondary">Produits</th>
                      <th scope="col" class="text-secondary">Disponibilité</th>
                      <th scope="col" class="text-secondary text-center">
                        Choix
                      </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr
                      *ngFor="let articles of filteredArticleListFree ; let i = index"
                      style="font-size: small"
                    >
                      <th scope="row">{{ articles.reference }}</th>
                      <th scope="row">{{ articles.libelle }}</th>
                      <th scope="row">{{ stocksDisponibles[articles.liquide.id] }}</th>
                      <td class="">
                        <input
                          type="checkbox"
                          class="form-control-custom"
                          [name]="'checkbox_free_' + i"
                          [(ngModel)]="articles.isChecked"
                          (change)="onCheckboxFreeChange(articles)"
                          [disabled]="stocksDisponibles[articles.liquide.id] <=0"
                        />

                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </fieldset>
            </div>
          </form>
        </div>
        <div class="modal-footer gap-3 px-4y">
          <button
            (click)="OnCloseChoiceFreeModal()"
            type="button"
            class="btn btn-secondary px-2"
          >
            Annuler
          </button>
          <button
            type="submit"
            (click)="onSubmitSelection()"
            class="btn btn-primary px-2"
          >
            Valider
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal détail -->
  <!-- Modal -->
  <div *ngIf="isModalOpenSign" class="custom-modal">
    <div
      class="modal-dialog-sign modal-dialog-centered"
      style=" max-width: 1200px"
    >
      <div class="modal-content">
        <!-- Header -->
        <div class="modal-header">
          <h5 class="modal-title text-success">Signature</h5>
          <button type="button" class="btn-close" aria-label="Close"></button>
        </div>

        <!-- Body -->
        <div
          class="modal-body"
          style="padding: 20px; max-height: 70vh; overflow-y: auto"
        >
          <div class="row">
            <!-- Regroupement et Zone -->
          </div>
          <div class="col-md-12">
            <div class="row">
              <div class="container">
                <img style="width:100%;height:100%" *ngIf="signature" [src]=signature alt="">
              </div>
            </div>
          </div>
        </div>

        <!-- Table des commandes -->
        <div class="modal-footer gap-3 px-4">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="closeDetailSign()"
          >
            Fermer
          </button>
        </div>
      </div>
    </div>
  </div>
