<div
  class="gap-2 d-flex align-items-center mb-3"
  style="cursor: pointer"
  (click)="goBack()"
>
  <i style="font-size: 18px" class="fas fw-bold fa-chevron-left me-2"></i>
  <h4 class="fw-bold mb-0">Fournisseurs</h4>
</div>
<div class="card">
  <div>
    <span style="font-size:13px;">Nombre: </span>
    <span style="font-size:13px;" class="fw-bold text-secondary">{{ filteredCount }}</span>
  </div>
  <p-table
    #dt
    [styleClass]="'p-datatable-sm'"
    #dt2
    [value]="dataList"
    dataKey="id"
    [rows]="8"
    [rowsPerPageOptions]="[10, 25, 50]"
    [globalFilterFields]="['raisonSocial', 'nomProprietaire', 'nomGerant']"
    (onFilter)="updateFilteredCount(dt)"
    [paginator]="true"
    (onPage)="onPage($event)"
  >
    <ng-template pTemplate="caption">
      <div class=" d-flex justify-content-between py-3">
                <span class="p-input-icon-left ml-auto d-flex align-items-center">
                    <i class="fas fa-search"></i>
                    <input style="width: 300px; border-radius: 7px;" pInputText type="text"
                           (input)="filterGlobal($event)" placeholder="Recherche"/>
                </span>
        <button type="button" class="btn btn-secondary px-4" (click)="OnCreate()">
          Créer un fournisseur
        </button>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th style="color: var(--secondary-color)">Code Fss</th>
        <th style="color: var(--secondary-color)">Nom Fournisseur</th>
        <th style="color: var(--secondary-color)">Code groupe</th>
        <th style="color: var(--secondary-color)">Adresse</th>
        <th style="color: var(--secondary-color)">Pays</th>
        <th style="color: var(--secondary-color)">Devise</th>
        <th style="color: var(--secondary-color)">Téléphone 1</th>
        <th style="color: var(--secondary-color)">Téléphone 2</th>
        <th style="color: var(--secondary-color)">Site web</th>
        <th
          class="d-flex justify-content-center"
          style="color: var(--secondary-color)"
        >
          Actions
        </th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-dataList>
      <tr>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList.codeClient }}
          </span>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList.agentCommercial.nom + ' ' + dataList.agentCommercial.prenoms }}
          </span>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList.raisonSocial }}
          </span>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList.nomGerant }}
          </span>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList.nomProprietaire }}
          </span>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList.groupeClient.nomGroupe }}
          </span>
        </td>
        <td>
      <tr class="d-flex justify-content-center gap-3">
        <td>
          <i *ngIf="dataList.isValide && !dataList.isAssocie" class="fa-solid fa-crown" style="color:#ffc400"
          ></i>
          <i
            *ngIf="!dataList.isValide && !dataList.isAssocie"
            [ngStyle]="{
                        'color': dataList.isValide ? 'gray' : '#08AD36',
                      }"
            (click)="OnValidate(dataList)"
            style="cursor: pointer"
            class="fas fa-check fw-bold"
          ></i>
        </td>
        <td>
          <i
            (click)="OnEdit(dataList)"
            style="cursor: pointer"
            class="fas fa-edit text-secondary fw-bold"
          ></i>
        </td>
        <td>
          <i
            (click)="OnDelete(dataList.id)"
            style="cursor: pointer"
            class="fas fa-trash-alt text-danger fw-bold"
          ></i>
        </td>
      </tr>
      </td></tr
      ></ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">Aucun article trouvé.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<div *ngIf="isModalOpen" class="custom-modal">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header d-flex align-items-center">
        <div
          class="d-flex justify-content-center align-items-center"
          style="
            background-color: #dbffe8;
            border-radius: 50%;
            width: 3rem;
            height: 3rem;
          "
        >
          <i class="fas fa-box-check text-success fs-4"></i>
        </div>
        <h1 *ngIf="operation == 'create'" class="modal-title fs-5 ms-3" id="staticBackdropLabel">Création
          de client revendeur</h1>
        <h1 *ngIf="operation == 'edit'" class="modal-title fs-5 ms-3" id="staticBackdropLabel">Modification de
          client revendeur</h1>
        <button
          type="button"
          class="btn-close"
          aria-label="Close"
          (click)="OnCloseModal()"
        ></button>
      </div>
      <div class="modal-body" style="max-height: 70vh; overflow-y: auto">
        <form [formGroup]="revendeurForm" (ngSubmit)="onSubmit()">
          <fieldset class="border px-3 pb-2" *ngIf="!isEditMode">
            <legend class="float-none w-auto px-2">Voulez-vous l'associer ?</legend>
            <div class="row">
              <div class="col-md-6">
                <div class="form-check">
                  <input class="form-check-input" formControlName="isAssocie" type="checkbox" id="associerCheckbox"
                         (change)="activateField(!isActive)">
                  <label class="form-check-label" for="associerCheckbox">
                    Associer
                  </label>
                </div>
                <ng-select
                  formControlName="parentRevendeurId"
                  (change)="preloadData($event)"
                  [readonly]="!isActive"
                  class="form-control"
                  [items]="revendeurConfirmed"
                  bindLabel="raisonSocial"
                  bindValue="id"
                  [searchable]="true"
                >
                </ng-select>
              </div>
            </div>
          </fieldset>
          <!-- REFERENCES -->
          <fieldset class="border p-3 mb-3">
            <legend class="float-none w-auto px-2">Références</legend>
            <div class="row" *ngIf="isEditMode">
              <label>Numero SAP : {{ numeroSap?.numeroSAP }}</label>
            </div>

            <div class="row">
              <div class="col-md-6 mt-3">
                <label for="groupeClientId" class="form-label"
                >Type de Client</label
                >
                <ng-select
                  class="form-control"
                  [items]="clientTypes"
                  bindLabel="nomGroupe"
                  bindValue="id"
                  formControlName="groupeClientId"
                  [searchable]="true"
                >
                </ng-select>
              </div>
              <div class="col-md-6 mt-3">
                <label for="numeroRegistre" class="form-label"
                >N° Registre de commerce</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="numeroRegistre"
                  formControlName="numeroRegistre"
                  placeholder="Entrez le numéro"
                />
              </div>
              <div class="col-md-6 mt-3">
                <label for="raisonSociale" class="form-label"
                >Raison sociale</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="raisonSociale"
                  formControlName="raisonSocial"
                  placeholder="Entrez la raison sociale"
                />
              </div>

              <div class="col-md-6 mt-3">
                <label for="compteContribuable" class="form-label"
                >N° Compte contribuable</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="compteContribuable"
                  formControlName="numeroCompteContribuable"
                  placeholder="Entrez le numéro"
                />
              </div>
            </div>
          </fieldset>

          <!-- ADRESSE -->
          <fieldset class="border p-3 mb-3">
            <legend class="float-none w-auto px-2">Adresse</legend>
            <div class="row">
              <div class="col-md-6">
                <label for="latitude" class="form-label">latitude</label>
                <input
                  type="text"
                  class="form-control"
                  id="latitude"
                  formControlName="latitude"
                  placeholder="Entrez la latitude"
                />
              </div>
              <div class="col-md-6">
                <label for="longitude" class="form-label">longitude</label>
                <input
                  type="text"
                  class="form-control"
                  id="longitude"
                  formControlName="longitude"
                  placeholder="Entrez la longitude"
                />
              </div>
              <div class="col-md-6">
                <label for="telephone" class="form-label">Téléphone</label>
                <input
                  type="text"
                  class="form-control"
                  id="telephone"
                  formControlName="telephone"
                  placeholder="Entrez le téléphone"
                />
              </div>
              <div class="col-md-6">
                <label for="depot" class="form-label">Dépôt</label>
                <!-- <select
                  class="form-select"
                  id="depot"
                  formControlName="depotId"
                >
                  <option *ngFor="let depot of depots" [value]="depot.id">
                    {{ depot.nomDepot }}
                  </option>
                </select> -->
                <ng-select
                  class="form-control"
                  [items]="depots"
                  bindLabel="nomDepot"
                  bindValue="id"
                  (change)="onDepotChange($event)"
                  formControlName="depotId"
                  [searchable]="true"
                >
                </ng-select>
              </div>
              <!-- <div class="col-md-6 mt-3">
                  <label for="localite" class="form-label">Localité</label>
                  <select class="form-select" id="localite" formControlName="localiteId">
                    <option *ngFor="let loc of localites" [value]="loc">{{ loc }}</option>
                  </select>
                </div> -->
              <div class="col-md-6">
                <label for="zone" class="form-label">Zone de livraison</label>
                <!-- <select
                  class="form-select"
                  id="zone"
                  formControlName="zoneDeLivraisonId "
                >
                  <option *ngFor="let zone of zoneLivraison" [value]="zone.id">
                    {{ zone.nomZone }}
                  </option>
                </select> -->
                <ng-select
                  class="form-control"
                  [items]="zoneLivraison"
                  bindLabel="nomZone"
                  bindValue="id"
                  formControlName="zoneDeLivraisonId"
                  [searchable]="true"
                >
                </ng-select>
              </div>
            </div>
          </fieldset>

          <!-- GESTION -->
          <fieldset class="border p-3 mb-3">
            <legend class="float-none w-auto px-2">Gestion</legend>
            <div class="row">
              <div class="col-md-6">
                <label for="nomProprietaire" class="form-label"
                >Nom du propriétaire</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="nomProprietaire"
                  formControlName="nomProprietaire"
                  placeholder="Entrez le nom"
                />
              </div>
              <div class="col-md-6">
                <label for="telProprietaire" class="form-label"
                >Tel du propriétaire</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="telProprietaire"
                  formControlName="telephoneProprietaire"
                  placeholder="Entrez le téléphone"
                />
              </div>
              <!--              <div class="col-md-6 mt-3">-->
              <!--                <label for="contact" class="form-label">Tel du propriétaire</label>-->
              <!--                <input-->
              <!--                  type="text"-->
              <!--                  class="form-control"-->
              <!--                  id="contact"-->
              <!--                  formControlName="contact"-->
              <!--                  placeholder="Entrez le contact"-->
              <!--                />-->
              <!--              </div>-->
              <div class="col-md-6 mt-3">
                <label for="nomGerant" class="form-label">Nom du gérant</label>
                <input
                  type="text"
                  class="form-control"
                  id="nomGerant"
                  formControlName="nomGerant"
                  placeholder="Entrez le nom"
                />
              </div>
              <div class="col-md-6 mt-3">
                <label for="telGerant" class="form-label">Tel du gérant</label>
                <input
                  type="text"
                  class="form-control"
                  id="telGerant"
                  formControlName="telephoneGerant"
                  placeholder="Entrez le téléphone"
                />
              </div>
            </div>
          </fieldset>

          <!-- AUTRES -->
          <fieldset class="border p-3 mb-3">
            <legend class="float-none w-auto px-2">Autres</legend>
            <div class="row">
              <div class="col-md-6">
                <label for="quantiteMinimum" class="form-label"
                >Quantité minimum à commander</label
                >
                <input
                  type="number"
                  class="form-control"
                  id="quantiteMinimum"
                  formControlName="quantiteMinimumACommander"
                  placeholder="Entrez la quantité"
                />
              </div>
              <div class="col-md-6">
                <label for="familleProduit" class="form-label"
                >Famille de produit (Produit favoris)</label
                >
                <!-- <select
                  class="form-select"
                  id="familleProduit"
                  formControlName="familleProduitId"
                >
                  <option
                    *ngFor="let produit of ListGroupesArticles"
                    [value]="produit.id"
                  >
                    {{ produit.libelle }}
                  </option>
                </select> -->
                <ng-select
                  class="form-control"
                  [items]="ListGroupesArticles"
                  bindLabel="libelle"
                  bindValue="id"
                  formControlName="familleProduitId"
                  [searchable]="true"
                >
                </ng-select>
              </div>
            </div>
          </fieldset>

          <!-- FOOTER -->
          <div class="modal-footer gap-3 px-4">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="OnCloseModal()"
            >
              Annuler
            </button>
            <button
              type="submit"
              [disabled]="revendeurForm.invalid"
              class="btn btn-primary"
            >
              Enregistrer
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div *ngIf="isModalDetail" class="custom-modal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header d-flex align-items-center">
        <div
          class="d-flex justify-content-center align-items-center"
          style="
            background-color: rgb(219, 255, 232);
            border-radius: 3rem;
            width: 3rem;
            height: 3rem;
          "
        >
          <i class="fas fa-box-check text-primary fs-3"></i>
        </div>
        <h1 class="modal-title fs-5 ms-3" id="staticBackdropLabel">
          Détails revendeur
        </h1>
        <!-- <div class="d-flex align-items-center">
          <i class="fas fa-box-check text-primary fs-3"></i>
          <h5 class="modal-title" id="staticBackdropLabel">Détails Client</h5>
        </div> -->
        <button
          type="button"
          class="btn-close justify-content-end"
          (click)="OnCloseDetailModal()"
        >
          <i class="fas fa-window-close fs-4 me-2"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="zone-livraison mb-3">
          <strong>Zone de livraison : </strong>
          <span>{{ RevendeurDetail.zoneDeLivraison.nomZone }}</span>
        </div>
        <div class="row">
          <div class="col-md-6">
            <strong>Groupe de client :</strong>
            <span>{{ RevendeurDetail.groupeClient.nomGroupe }}</span>
          </div>
          <div class="col-md-6">
            <strong>Propriétaire :</strong>
            <span>{{ RevendeurDetail.nomProprietaire }}</span>
          </div>
          <div class="col-md-6">
            <strong>Gérant :</strong>
            <span>{{ RevendeurDetail.nomGerant }}</span>
          </div>
          <div class="col-md-6">
            <strong>Établissement :</strong>
            <span>{{
                RevendeurDetail.nomEtablissement
                  ? RevendeurDetail.nomEtablissement
                  : RevendeurDetail.raisonSocial
              }}</span>
          </div>
          <div class="col-md-6">
            <strong>Contact Gérant :</strong>
            <span>{{ RevendeurDetail.telephoneGerant }}</span>
          </div>
          <div class="col-md-6 mb-4">
            <strong>Téléphone :</strong>
            <span>{{ RevendeurDetail.telephoneProprietaire }}</span>
          </div>
          <div class="col-md-6">
            <label for="rccm" class="form-label"
            >Registre de commerce </label
            >
            <input
              type="file"
              class="form-control"
              id="rccm"
              (change)="onRccmSelected($event)"
              placeholder="Importez"
              (change)="onFileSelected($event)"
            />
          </div>
          <div class="col-md-6">
            <label for="cni" class="form-label"
            >CNI <span class="text-danger">*</span></label
            >
            <input
              type="file"
              class="form-control"
              (change)="onCniSelected($event)"
              id="cni"
              placeholder="Importez"
            />
          </div>
          <div class="col-md-6">
            <label for="dfe" class="form-label"
            >Déclaration fiscale (DFE)</label
            >
            <input
              type="file"
              (change)="onDfeSelected($event)"
              class="form-control"
              id="dfe"
              placeholder="Importez"
            />
          </div>
          <div class="col-md-6">
            <label for="dfe" class="form-label"
            >Numero SAP <span class="text-danger">*</span></label
            >
            <input
              type="text"
              class="form-control"
              id="numeroSap"
              [(ngModel)]="numeroSap"
              placeholder="Entrez le numéro SAP"
            />
          </div>
        </div>
      </div>
      <div class="modal-footer d-flex justify-content-end gap-2">
        <button (click)="OnCloseDetailModal()" class="btn btn-secondary">
          Fermer
        </button>
        <button
          *ngIf="!RevendeurDetail.isValide"
          (click)="confirmValidateOperation(RevendeurDetail)"
          class="btn btn-success"
        >
          Valider
        </button>
      </div>
    </div>
  </div>
</div>
