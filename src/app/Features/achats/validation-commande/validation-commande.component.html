<div class="card">
  <div class="row">
    <div class="col-12 col-sm-6 col-md-3 mb-3">
      <span>Numéro commande :</span>
      <span class="p-input-icon-left w-100 d-flex align-items-center">
        <i class="fas fa-search"></i>
        <input
          class="w-100"
          style="border-radius: 7px"
          pInputText
          type="text"
          [(ngModel)]="filters.numeroCommande"
          (keydown.enter)="filterGlobal()"
          placeholder="Recherche"
        />
      </span>
    </div>
  </div>
  <p-table [styleClass]="'p-datatable-sm'" #dt2 [value]="ListCommandeFournisseurs" dataKey="id" [rows]="8"
           [rowsPerPageOptions]="[10, 25, 50]" [paginator]="true" (onPage)="onPage($event)"
           [totalRecords]="totalPages" [lazy]="true">

    <ng-template pTemplate="header">
      <tr>
        <th style="color: var(--secondary-color)">N° commande</th>
        <th style="color: var(--secondary-color)">Nature</th>
        <th style="color: var(--secondary-color)">Fournisseur</th>
        <th style="color: var(--secondary-color)">Date commande</th>
        <th style="color: var(--secondary-color)">Date livraison estimé</th>
        <th style="color: var(--secondary-color)">Magasin à approvisionner</th>
        <th style="color: var(--secondary-color)">Statut</th>
        <th style="color: var(--secondary-color)">Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-ListCommandeFournisseurs let-i="index">
      <tr>
        <td>
          {{ ListCommandeFournisseurs?.NumCommande }}
        </td>
        <td>
          {{ ListCommandeFournisseurs?.typeCommande == 'BNS_VERS_REVENDEUR' ? TypeCommandeFournisseur.BNS_VERS_REVENDEUR : TypeCommandeFournisseur.BNS_VERS_FOURNISSEUR }}
        </td>
        <td>
          {{ ListCommandeFournisseurs?.fournisseur?.nom || 'N/A' }}
        </td>
        <td>
          {{ ListCommandeFournisseurs?.dateCommande }}
        </td>

        <td>
            <span class="ml-1 vertical-align-middle">
             {{ ListCommandeFournisseurs?.dateLivraisonEstimee || 'N/A' }}
            </span>
        </td>
        <td>
            <span class="ml-1 vertical-align-middle">
             {{ ListCommandeFournisseurs?.depot?.nomDepot || ListCommandeFournisseurs.revendeur.raisonSocial }}
            </span>
        </td>
        <td>
            <span class="ml-1 vertical-align-middle">
             {{ ListCommandeFournisseurs?.statut }}
            </span>
        </td>
        <td>
      <tr class="d-flex justify-content-center gap-3">
        <td>
          <i
            (click)="OnEdit(ListCommandeFournisseurs)"
            style="cursor: pointer"
            class="fas fa-eye text-secondary"
          ></i>
        </td>
        <td>
          <i
            (click)="OnDelete(ListCommandeFournisseurs?.id)"
            style="cursor: pointer"
            class="fas fa-trash-alt text-danger"
          ></i>
        </td>
      </tr>
      </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">Aucune commande trouvé.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Modal -->
<div *ngIf="isModalOpen" class="custom-modal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header d-flex align-items-center">
        <div
          class="d-flex justify-content-center align-items-center"
          style="
              background-color: rgb(219, 255, 232);
              border-radius: 3rem;
              width: 3rem;
              height: 3rem;
            "
        >
          <i class="fas fa-box-check text-primary fs-3"></i>
        </div>
        <h1
          *ngIf="operation == 'create'"
          class="modal-title fs-5 ms-3"
          id="staticBackdropLabel"
        >
          Création de la commande
        </h1>
        <h1
          *ngIf="operation == 'edit'"
          class="modal-title fs-5 ms-3"
          id="staticBackdropLabel"
        >
          Détails de la commande
        </h1>
      </div>
      <div class="modal-body">

        <div *ngIf="operation == 'edit'">
          <fieldset class="row border my-1">
            <legend style="font-size: 14px;" class="text-secondary">Numero Commande : {{ updateData?.NumCommande }}
              du {{ updateData?.createdAt | date :"dd/MM/yyyy" }}
            </legend>
          </fieldset>

          <fieldset class="row border my-2">
            <legend style="font-size: 14px;" class="text-secondary">Informations du client</legend>
            <div class="row">
              <div class="col-md-4">
                <strong>Client : </strong>
                <span>{{ updateData?.revendeur?.raisonSocial }}</span>
              </div>
              <div class="col-md-4">
                <strong>Groupe :</strong>
                <span>{{ updateData?.revendeur?.groupeClient.nomGroupe }}</span>
              </div>
              <div class="col-md-4">
                <strong>Contact gérant : </strong>
                <span>{{ updateData?.revendeur?.telephoneGerant }}</span>
              </div>
              <div class="col-md-4">
                <strong>Contact Propriétaire : </strong>
                <span>{{ updateData?.revendeur?.telephoneProprietaire }}</span>
              </div>
              <div class="col-md-4">
                <strong>Facturé au : </strong>
                <span>{{ updateData?.revendeur?.typePrix?.libelle }}</span>
              </div>
              <div class="col-md-4">
                <strong>Crédit liquide: </strong>
                <!--                <span>{{ updateData?.revendeur?.typePrix?.libelle }}</span>-->
              </div>
              <div class="col-md-4">
                <strong>Crédit emballage: </strong>
                <!--   <span>{{ updateData?.revendeur?.typePrix?.libelle }}</span>-->
              </div>
            </div>
          </fieldset>
          <fieldset class="row border my-2">
            <legend style="font-size: 14px;" class="text-secondary">Autres informations</legend>
            <div class="row">
              <div class="col-md-4">
                <strong>Date commande : </strong>
                <span>{{ updateData?.dateCommande }}</span>
              </div>
              <div class="col-md-4">
                <strong>Date livraison estimée : </strong>
                <span>{{ updateData?.dateLivraisonEstimee }}</span>
              </div>
              <div class="col-md-4">
                <strong>Statut : </strong>
                <span>{{ updateData?.statut }}</span>
              </div>
            </div>
          </fieldset>
        </div>
        <div class="p-2 mt-3">
          <div style="max-height: 350px; overflow-y: auto">
            <table *ngIf="operation == 'edit'" class="table table-bordered">
              <thead class="table-success">
              <!-- Première ligne d'en-tête -->
              <tr>
                <th scope="col" colspan="5">PRIX UNITAIRE TTC(FCFA)</th>
                <th scope="col" colspan="3">MONTANT TTC(FCFA)</th>
              </tr>
              <!-- Deuxième ligne d'en-tête -->
              <tr>
                <th scope="col">Liquide</th>
                <th scope="col">Liquide (FCFA)</th>
                <th scope="col">Emballage (FCFA)</th>
                <th scope="col">Total (FCFA)</th>
                <th scope="col">Qte</th>
                <th scope="col">Liquide (FCFA)</th>
                <th scope="col">Emballage (FCFA)</th>
                <th scope="col">Total (FCFA)</th>
              </tr>
              </thead>

              <tbody>
              <tr *ngFor="let item of updateData?.articles">
                <td>{{ item.liquide.libelle }}1</td>
                <td>{{ item.prixUnitaireLiquide }}</td>
                <td>{{ item.prixUnitaireEmballage }}</td>
                <td>{{ Number(item.prixUnitaireLiquide ?? 0) + Number(item.prixUnitaireEmballage ?? 0) }}</td>
                <td>{{ item.quantite }}</td>
                <td>{{ item.montantLiquide }}</td>
                <td>{{ item.montantEmballage }}</td>
                <td>{{ Number(item.montantLiquide ?? 0) + Number(item.montantEmballage ?? 0) }}</td>

              </tr>
              <tr class="table-dark">
                <th scope="col" colspan="4">Total :</th>
                <td>{{ totalQte }}</td>
                <td>{{ totalLiquide }}</td>
                <td>{{ totalEmballage }}</td>
                <td>{{ totalGlobal }}</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="modal-footer gap-3 px-4">
        <button
          (click)="OnCloseModal()"
          type="button"
          class="btn btn-secondary px-2"
        >
          Fermer
        </button>
        <button
          type="submit"
          [disabled]="updateData.statut !== StatutCommande.ATTENTE_VALIDATION"
          (click)="onValidate()"
          class="btn btn-primary px-2"
        >
          Valider
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div *ngIf="isModalValidOpen" class="custom-modal">
  <div class="modal-dialog2 modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header d-flex align-items-center">
        <div
          class="d-flex justify-content-center align-items-center"
          style="
              background-color: rgb(219, 255, 232);
              border-radius: 3rem;
              width: 3rem;
              height: 3rem;
            "
        >
          <i class="fas fa-box-check text-primary fs-3"></i>
        </div>
        <h1
          class="modal-title fs-5 ms-3"
          id="staticBackdropLabel"
        >
          Validation de la commande
        </h1>
      </div>
      <div class="modal-body">
        <form [formGroup]="ValidationForm">
          <div class="row g-3">
            <div class="col-md-6">
              <label for="" class="form-label">Fournisseur</label>
              <span class="text-danger">*</span>
              <ng-select
                class="form-control"
                [items]="Listfournisseurs"
                bindLabel="nom"
                bindValue="id"
                formControlName="fournisseurId"
                [searchable]="true"
              >
              </ng-select>
            </div>

            <div class="col-md-6">
              <label for="datelivraison" class="form-label"
              >Date livraison estimée<span class="text-danger">*</span></label
              >
              <input
                type="date"
                class="form-control"
                id="datelivraison"
                formControlName="dateLivraisonEstimee"
                [min]="minDate"
              />
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer gap-3 px-4">
        <button
          (click)="OnCloseValidModal()"
          type="button"
          class="btn btn-secondary px-2"
        >
          Fermer
        </button>
        <button
          type="submit"
          (click)="onSubmit()"
          class="btn btn-primary px-2"
        >
          Terminer
        </button>
      </div>
    </div>
  </div>
</div>

