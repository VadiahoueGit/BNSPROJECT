<div class="card">
  <div class="row">
    <div class="col-12 col-sm-6 col-md-3 mb-3">
      <span>Commande :</span>
      <span class="p-input-icon-left w-100 d-flex align-items-center">
      <i class="fas fa-search"></i>
      <input class="w-100" style="border-radius: 7px;"
             pInputText type="text"
             [(ngModel)]="filters.commande"
             (keydown.enter)="filterGlobal()"
             placeholder="Recherche"/>
    </span>
    </div>
    <div class="col-12 col-sm-6 col-md-3 mb-3">
      <span>Agent :</span>
      <span class="p-input-icon-left w-100 d-flex align-items-center">
      <i class="fas fa-search"></i>
      <input class="w-100" style="border-radius: 7px;"
             pInputText type="text"
             [(ngModel)]="filters.agent"
             (keydown.enter)="filterGlobal()"
             placeholder="Recherche"/>
    </span>
    </div>
    <div class="col-12 col-sm-6 col-md-3 mb-3">
      <span>Client :</span>
      <span class="p-input-icon-left w-100 d-flex align-items-center">
      <i class="fas fa-search"></i>
      <input class="w-100" style="border-radius: 7px;"
             pInputText type="text"
             [(ngModel)]="filters.client"
             (keydown.enter)="filterGlobal()"
             placeholder="Recherche"/>
    </span>
    </div>
    <div class="col-12 col-sm-6 col-md-3 mb-3">
      <span>Statut :</span>
      <span class="p-input-icon-left w-100 d-flex align-items-center">
      <i class="fas fa-search"></i>
      <input class="w-100" style="border-radius: 7px;"
             pInputText type="text"
             [(ngModel)]="filters.statut"
             (keydown.enter)="filterGlobal()"
             placeholder="Recherche"/>
    </span>
    </div>
  </div>

  <p-table
    [styleClass]="'p-datatable-sm'"
    #dt2
    [value]="dataList"
    dataKey="id"
    [rows]="8"
    [totalRecords]="totalPages" [lazy]="true"
    [rowsPerPageOptions]="[10, 25, 50]"
    [paginator]="true"
    (onPage)="onPage($event)"
  >
    <ng-template pTemplate="header">
      <tr>
        <th style="color: var(--secondary-color)">Motif</th>
        <th style="color: var(--secondary-color)">Agent</th>
        <th style="color: var(--secondary-color)">Rôle</th>
        <th style="color: var(--secondary-color)">Montant à verser</th>
        <th style="color: var(--secondary-color)">Montant versé</th>
        <th style="color: var(--secondary-color)">Montant dû</th>
        <th style="color: var(--secondary-color)">Date création</th>
        <th style="color: var(--secondary-color)">Statut</th>
        <th style="color: var(--secondary-color)">Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-dataList>
      <tr>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList?.motif }}
          </span>
        </td>
        <td>
          {{
            dataList?.encaisseurCommercial.nom+' '+dataList?.encaisseurCommercial.prenoms|| 'N/A'
          }}
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{  dataList?.encaisseurCommercial.role}}
          </span>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList?.montantAttendu | number }}
          </span>
        </td>
        <td>
          {{ dataList?.montantRecu | number }}
        </td>
        <td>
          {{ dataList?.montantEcart | number }}
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList?.dateCreation | date : "dd/MM/yyyy" }}
          </span>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList?.statut }}
          </span>
        </td>
        <td>
      <tr class="d-flex justify-content-center gap-3">
        <td>
          <i
            (click)="OnEdit(dataList)"
            style="cursor: pointer"
            class="fas fa-eye text-secondary"
          ></i>
        </td>
        <!-- <td><i (click)="OnDelete(dataList.id)" style="cursor: pointer;"
                    class="fas fa-trash-alt text-danger"></i></td> -->
      </tr>
      </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">Aucun élément trouvé.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Modal creation -->
<!-- Modal -->
<div *ngIf="isModalOpen" class="custom-modal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header d-flex align-items-center p-3">
        <div
          class="d-flex justify-content-center align-items-center"
          style="
            background-color: rgb(219, 255, 232);
            border-radius: 3rem;
            width: 3rem;
            height: 3rem;
          "
        >
          <i class="fas fa-box-check text-primary fs-3"></i>
        </div>

        <h1 class="modal-title fs-5 ms-3" id="staticBackdropLabel">
          Validation du paiement
        </h1>
      </div>
      <div class="modal-body" *ngIf="operation == 'edit'" style="max-height: 70vh;overflow-y: auto;">
        <ng-container>
          <fieldset class="row border my-1">
            <div class="row">
              <div class="col-md-4">
                <strong>Créancier: </strong>
                <span>{{updateData.encaisseurCommercial ?  updateData.encaisseurCommercial?.nom+' '+updateData.encaisseurCommercial?.prenoms
                  : updateData.encaisseurTransporteur?.nom+' '+updateData.encaisseurTransporteur?.prenoms}}
                  </span>
              </div>
              <div class="col-md-4">
                <strong>Poste: </strong>
                <span>{{ updateData?.encaisseurCommercial ? 'Commercial' : 'Transporteur' }}</span>
              </div>
            </div>
          </fieldset>
          <fieldset class="row border my-1">
            <legend style="font-size: 14px" class="text-secondary">
              Autres informations
            </legend>
            <div class="row">
              <div class="col-md-4">
                <strong>Motif : </strong>
                <span>{{ updateData?.motif }}</span>
              </div>
              <div class="col-md-4">
                <strong>Montant à percevoir : </strong>
                <span>{{ updateData?.montantAttendu| currency:'XOF' }}</span>
              </div>
              <div class="col-md-4">
                <strong>Montant perçu : </strong>
                <span>{{ updateData?.montantRecu| currency:'XOF' }}</span>
              </div>
              <div class="col-md-4">
                <strong>Total créance reglée : </strong>
                <span>{{ updateData?.montantPaye | currency:'XOF' }}</span>
              </div>
              <div class="col-md-4">
                <strong>Montant restant : </strong>
                <span>{{ updateData?.montantEcart | currency:'XOF' }}</span>
              </div>
            </div>
          </fieldset>
          <fieldset class="row border my-2" >
            <legend class="fs-6 text-primary">Historique de paiement</legend>
            <div
              class="table-responsive"
              style="max-height: 300px; overflow-y: auto"
            >
              <table class="table">
                <thead>
                <tr style="font-size: small">
                  <th scope="col">Numero de paiement</th>
                  <th scope="col">Montant versé</th>
                  <th scope="col">Date de paiement</th>
                </tr>
                </thead>
                <tbody>
                <tr
                  style="font-size: small"
                  *ngFor="let item of updateData.historiquePaiement; let i = index "
                >
                  <td>{{ item.numeroPaiement }}</td>
                  <td>{{ item.montantPaye | number }}</td>
                  <td>{{ item.datePaiement | date:'dd/MM/yyyy HH:mm' }}</td>
                </tr>
                <tr *ngIf="updateData.historiquePaiement.length == 0" style="font-size: small" class="w-100 d-flex justify-content-center">
                  <label class="text-gray">Aucun paiement</label>
                </tr>
                <!-- Ajoutez d'autres lignes si nécessaire -->
                </tbody>
              </table>
            </div>
          </fieldset>
        </ng-container>
      </div>

      <div class="modal-footer gap-3 px-4">
        <input
          style="width:120px !important;"
          type="number"
          name="search"
          [(ngModel)]="amountReal"
          class="form-control"
        />FCFA
        <button
          type="button"
          class="btn btn-warning px-5"
          [disabled]="!amountReal || +amountReal <= 0"
          (click)="ValidatePaiement()"
        >
          Payer
        </button>
        <button
          (click)="OnCloseModal()"
          type="button"
          class="btn btn-secondary px-2"
        >
          Annuler
        </button>
      </div>
    </div>
  </div>
</div>
