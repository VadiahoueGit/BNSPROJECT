<div class="card">
  <div class="d-flex justify-content-end py-3">
    <button type="button" class="btn btn-secondary px-4" (click)="OnCreate()">
      Ajouter un crédit
    </button>
  </div>
  <p-table
    [styleClass]="'p-datatable-sm'"
    #dt2
    [value]="dataList"
    dataKey="id"
    [totalRecords]="totalPages" [lazy]="true"

    [rows]="8"
    [rowsPerPageOptions]="[10, 25, 50]"
    [paginator]="true"
    (onPage)="onPage($event)"
  >
    <ng-template pTemplate="header">
      <tr>
        <th style="color: var(--secondary-color)">Type client</th>
        <th style="color: var(--secondary-color)">Groupe client</th>
        <th style="color: var(--secondary-color)">Client ou commercial</th>
        <th style="color: var(--secondary-color)">Credit emballage</th>
        <th style="color: var(--secondary-color)">Crédit liquide</th>
        <th style="color: var(--secondary-color)">Total crédit</th>
        <th style="color: var(--secondary-color)">Actions</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-dataList>
      <tr>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList.clientType }}
          </span>
        </td>
        <td>
          <span>{{ dataList.client?.groupeClient?.nomGroupe || dataList.client?.GroupeClient?.nomGroupe || 'Commercial' }}</span>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList.client?.raisonSocial ? dataList.client?.raisonSocial : dataList?.client?.nom + ' ' + dataList?.client?.prenoms }}
          </span>
        </td>
        <td>
          {{ dataList.creditEmballageDeduit }}
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList.creditLiquideDeduit }}
          </span>
        </td>
        <td>
          <span class="ml-1 vertical-align-middle">
            {{ dataList.totalCreditDeduit }}
          </span>
        </td>

        <td>
      <tr class="d-flex justify-content-center gap-3">
        <td>
          <i
            (click)="OnDetails(dataList)"
            style="cursor: pointer"
            class="fas fa-eye text-secondary"
          ></i>
        </td>
        <td>
          <i
            (click)="OnEdit(dataList)"
            style="cursor: pointer"
            class="fas fa-edit text-secondary"
          ></i>
        </td>
        <td>
          <i
            (click)="OnDelete(dataList.id)"
            style="cursor: pointer"
            class="fas fa-trash-alt text-danger"
          ></i>
        </td>
      </tr>
      </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">Aucun élément trouvé.</td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Modal creation -->
<!-- Modal -->
<div *ngIf="isModalOpen" class="custom-modal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header d-flex align-items-center">
        <div
          class="d-flex justify-content-center align-items-center"
          style="
            background-color: rgb(219, 255, 232);
            border-radius: 3rem;
            width: 3rem;
            height: 3rem;
          "
        >
          <i class="fas fa-box-check text-primary fs-3"></i>
        </div>
        <h1
          *ngIf="operation == 'create'"
          class="modal-title fs-5 ms-3"
          id="staticBackdropLabel"
        >
          Ajouter de crédit
        </h1>
        <h1
          *ngIf="operation == 'edit'"
          class="modal-title fs-5 ms-3"
          id="staticBackdropLabel"
        >
          Modification de credit
        </h1>
        <h1
          *ngIf="operation == 'detail'"
          class="modal-title fs-5 ms-3"
          id="staticBackdropLabel"
        >
          Flux de credit
        </h1>
      </div>
      <div class="modal-body" style="max-height: 600px; overflow-y: auto">
        <form *ngIf="operation != 'detail'" [formGroup]="CreditForm">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="photo" class="form-label"
                >Clients ou commercial<span class="text-danger">*</span></label
                >
                <ng-select
                  class="form-control"
                  [items]="dataClient"
                  bindLabel="displayName"
                  bindValue="codeClient"
                  (change)="OnclientChange($event)"
                  formControlName="codeClient"
                  [searchable]="true"
                >
                </ng-select>
              </div>

              <div class="mb-3">
                <label for="libelle" class="form-label"
                >Crédit liquide <span class="text-danger">*</span></label
                >
                <input
                  type="number"
                  class="form-control"
                  id="libelle"
                  formControlName="creditLiquide"
                  placeholder="Entrez le montant"
                />
              </div>
              <div class="mb-3">
                <label for="categorieId" class="form-label"
                >Délai règlement(jours) <span class="text-danger">*</span></label
                >
                <input
                  type="number"
                  class="form-control"
                  formControlName="delaiReglement"
                />
              </div>
            </div>

            <div class="col-md-6">
              <div class="mb-3">
                <label for="format" class="form-label"
                >Crédit emballage <span class="text-danger">*</span></label
                >
                <input
                  type="number"
                  class="form-control"
                  formControlName="creditEmballage"
                  placeholder="Entrez le montant"
                />
              </div>

              <div class="mb-3">
                <label for="categorieId" class="form-label"
                >Total crédit <span class="text-danger">*</span></label
                >
                <input
                  type="number"
                  class="form-control"
                  formControlName="totalCredit"
                />
              </div>
      
            </div>
          </div>
        </form>
        <div class="row" *ngIf="operation == 'detail'" >
          <div class="col-md-4">
            <strong>Crée par : </strong>
            <span>{{ detail.createdBy.nom +' '+ detail.createdBy.nom }}</span>
          </div>
          <div class="col-md-4">
            <strong>Solde liquide : </strong>
            <span>{{ detail.soldeLiquide }}</span>
          </div>
          <div class="col-md-4">
            <strong>Solde emballage :</strong>
            <span>{{ detail.soldeEmballage }}</span>
          </div>
          <div class="col-md-4">
            <strong>Solde total : </strong>
            <span>{{ detail.totalSolde }}</span>
          </div>
        </div>
        <table *ngIf="operation == 'detail'" class="table table-bordered table-hover">
          <thead class="table-success">
          <tr>
            <th>Mouvements</th>
            <th>Descriptions</th>
            <th>Montant liquide</th>
            <th>Montant emballage</th>
            <th>Solde</th>
            <th>Date</th>
          </tr>
          </thead>
          <tbody>
          <!-- Boucle sur chaque format -->
          <tr *ngFor="let item of historiqueMouvement">
            <td>{{ item.typeMouvement }}</td>
            <td>{{ item.description }}</td>
            <td>{{ item.montantLiquide }}</td>
            <td>{{ item.montantEmballage }}</td>
            <td>{{ item.soldeApresMouvement }}</td>
            <td>{{ item.createdAt | date:'dd/MM/yyyy' }}</td>
          </tr>
          </tbody>
        </table>

      </div>

      <div class="modal-footer gap-3 px-4">
        <button
          (click)="OnCloseModal()"
          type="button"
          class="btn btn-secondary px-2"
        >
          Annuler
        </button>
        <button
          *ngIf="operation != 'detail'"
          type="submit"
          (click)="onSubmit()"
          class="btn btn-primary px-2"
          [disabled]="CreditForm.invalid"
        >
          Valider
        </button>
      </div>
    </div>
  </div>
</div>
